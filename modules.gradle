import groovy.json.JsonSlurper

gradle.ext {
    //Извлечение модулей из файла
    extractModules = { jsonFilePath -> Module.modules(jsonFilePath) }

    // Получение версии модуля на основе json-конфигурации
    // TODO если необходимо будет получать семплы, сделать функцию для samples.json
    getModuleVersion = { name, defaultVersion ->
        def modules = extractModules('modules.json')
        def module = modules.find { "$it.name" == "$name" }
        if (module != null && module.version != null && !module.version.isEmpty()) {
            module.version
        } else {
            "$defaultVersion"
        }
    }
}

class Module {
    final String name
    final String version
    final String path

    private Module(String name, String version, String path) {
        this.name = name
        this.version = version
        this.path = path
    }

    static def modules(final String fileName) {
        try {
            def jsonObject = new JsonSlurper().parse(new File(fileName), 'utf-8')
            assert jsonObject instanceof List

            def list = []
            jsonObject.each {
                list.add(new Module(it.name, it.version, it.path))
            }

            return list
        } catch (Exception ignored) {
            throw new GradleException("missing $fileName file or " +
                    "file is not well formatted in json")
        }
    }
}