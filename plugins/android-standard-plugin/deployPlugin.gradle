import ru.surfstudio.android.build.artifactory.ArtifactoryConfig
import ru.surfstudio.android.build.ConfigInfoProvider

group = ArtifactoryConfig.ANDROID_STANDARD_GROUP_ID
version = ConfigInfoProvider.getVersion()

apply plugin: 'maven'

task sourcesJar(type: Jar) {
    classifier = 'sources'
    from sourceSets.main.java.srcDirs
}

artifacts {
    archives sourcesJar
}

uploadArchives.repositories.mavenDeployer {
    pom {
        groupId = group
        artifactId = rootProject.name
        version = version

        withXml {
            def dependenciesNode = asNode().appendNode('dependencies')
            configurations.implementation.allDependencies.each {
                def dependencyNode = dependenciesNode.appendNode('dependency')
                dependencyNode.appendNode('groupId', it.group)
                dependencyNode.appendNode('artifactId', it.name)
                dependencyNode.appendNode('version', it.version)
            }
        }
    }

    repository(url: ArtifactoryConfig.DEPLOY_URL) {
        authentication(
                userName: ArtifactoryConfig.USER_NAME,
                password: ArtifactoryConfig.PASSWORD
        )
    }
}