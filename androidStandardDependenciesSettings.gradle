apply from: '../config.gradle'
apply plugin: 'maven'

// Функция, конфигурирующая зависимости android-standard для текущего модуля,
// контекст которого передается параметром.

gradle.ext.configAndroidStandardDependencies = { context, modules = [] ->
    // добавление зависимостей android-standard
    context.dependencies {
        modules.each {
            compileOnly context.project(":$it")
            testImplementation context.project(":$it")
            androidTestImplementation context.project(":$it")
        }
    }
    // определние функции для деплоя текущего модуля в artifactory
    context.afterEvaluate {
        uploadArchives {
            repositories.mavenDeployer {
                repository(url: 'https://artifactory.surfstudio.ru/artifactory/libs-release-local') {
                    authentication(
                            userName: System.getenv('surf_maven_username'),
                            password: System.getenv('surf_maven_password'))
                }

                def artifactGroupId = 'ru.surfstudio.android'
                def artifactVersion = "$moduleVersionName"

                pom.groupId = artifactGroupId
                pom.artifactId = project.name
                pom.version = artifactVersion

                pom.project {
                    dependencies {
                        modules.each {
                            def moduleName = "$it"
                            dependency {
                                groupId artifactGroupId
                                artifactId moduleName
                                version artifactVersion
                                scope "compile"
                            }
                        }
                    }
                } // pom
            } // repositories.mavenDeployer
        } // uploadArchives
    }
}