[Главная страница репозитория](../docs/main.md)

[TOC]

# Композиция
Композиция событий - один из вариантов реализации переиспользования логики в mvi.

Так как экраны явно типизированы по классу событий, которые лежат в папке с этими экранами, бывает 
достаточно проблематично настроить переиспользуемую логику.

Обычно, это значит, что Middleware экрана должен быть унаследован от какого-то интерфейса с логикой, 
а все переиспользуемые события должны наследоваться от интерфейсов переиспользуемых событий.

То есть, при реализации навигации, нам придется явно указывать, 
что наша Middleware главного экрана наследуется от NavigationMiddlewareInterface, 
а все события, которые отвечают за навигацию, наследуются от OpenScreenEvent/CloseScreenEvent, и их производных.

На практике, это рождает большое количество шаблонного кода, и может быть заменено на другой подход: 

Заводится родительское событие Navigation, которое наследуется от интерфейса NavigationComposition, и от события экрана T. 
В этом событии расположен список дочерних событий, которые не типизированы по экрану. Для навигации это будут наследники интерфейса NavigationEvent.

После этого, мы создаем Middleware, который будет работать с дочерними событиями (например, реализация NavigationMiddleware, работающая с NavigationEvent). 

И в нашем middleware экрана, в списке трансформаций, мы добавляем строку

    Navigation::class decomposeTo navigationMiddleware
    
Эта строка делает следующее: при каждом эмите в EventHub события Navigation, она извлекает дочерние события, и направляет в navigationMiddleware.
После того, как navigationMiddleware каким-то образом трансформировал их, и готов отдать результат, этот результат кладется в родительское событие Navigation, и отправляется в Middleware главного экрана.

Таким образом, можно показать схему композиции следующим образом: 

`Composition<E>` >> `E` >> `Middleware<E>` >>`E` >> `Composition<E>`