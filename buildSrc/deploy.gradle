import ru.surfstudio.android.build.InitializatorKt

apply from: '../../buildSrc/config.gradle'
apply plugin: 'maven'

// Функция, конфигурирующая зависимости android-standard для текущего модуля,
// контекст которого передается параметром.

ext.configDeploy = { context ->
    // определние функции для деплоя текущего модуля в artifactory
    context.afterEvaluate {
        uploadArchives {
            repositories.mavenDeployer {
                repository(url: 'https://artifactory.surfstudio.ru/artifactory/libs-release-local') {
                    authentication(
                            userName: System.getenv('surf_maven_username'),
                            password: System.getenv('surf_maven_password')
                    )
                }

//                def artifactGroupId = 'ru.surfstudio.android'
                def artifactGroupId = "com.example"
                def artifactName = InitializatorKt.getArtifactNameByLibName(project.name)
                def artifactVersion = "$moduleVersionName"

                pom.groupId = artifactGroupId
                pom.artifactId = artifactName
                pom.version = artifactVersion

                pom.project {
                    dependencies {
                        InitializatorKt.getDependsArtifactNamesByLibName(project.name).each {
                            dependency {
                                groupId artifactGroupId
                                artifactId it
                                version artifactVersion
                                scope "compile"
                            }
                        }
                    }
                } // pom
            } // repositories.mavenDeployer
        } // uploadArchives
    }
}